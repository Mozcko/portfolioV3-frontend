---
// Importamos solo los iconos de men칰 (SVG) desde el 칤ndice
import { menu, close } from "../../assets";
import { styles } from "../../styles";

// 1. OPTIMIZACI칍N: Importamos la imagen y el componente Image de Astro
import { Image } from 'astro:assets';
import logoImg from "../../assets/logo.jpeg";

interface Props {
  currentLang: string;
  t: Record<string, any>;
}

// Recibimos las props directamente
const { currentLang, t = {} } = Astro.props;

const navLinks = [
  { id: "about", title: t["navbar.about"] || "About" },
  { id: "works", title: t["navbar.work"] || "Work" },
  { id: "contact", title: t["navbar.contact"] || "Contact" },
];
---

<nav
  id="navbar"
  class={`${styles.paddingX} w-full flex items-center py-5 fixed top-0 z-20 bg-transparent transition-colors duration-300`}
>
  <div class='w-full flex justify-between items-center max-w-7xl mx-auto'>
    
    <a
      href={currentLang === 'es' ? '/es' : '/en'}
      class='flex items-center gap-2'
      onclick="window.scrollTo(0, 0);"
      data-astro-prefetch
    >
      <Image 
        src={logoImg} 
        alt="logo" 
        class="w-10 h-10 object-cover rounded-full border-2 border-white/10"
        width={40} 
        height={40}
      />
      <p class='text-white text-[18px] font-bold cursor-pointer flex '>
        Mozcko &nbsp;
        <span class='sm:block hidden'> | Portfolio</span>
      </p>
    </a>

    <div class="flex gap-8 items-center">
        <ul class='list-none hidden sm:flex flex-row gap-10'>
          {navLinks.map((nav) => (
              <li class="text-secondary hover:text-white text-[18px] font-medium cursor-pointer nav-item">
                <a href={`#${nav.id}`}>{nav.title}</a>
              </li>
          ))}
        </ul>

        <a
            href={currentLang === 'es' ? '/en' : '/es'}
            class="bg-white/10 hover:bg-white/20 text-white px-3 py-1 rounded-full text-xs font-bold border border-white/20 transition-all flex items-center gap-2 uppercase"
            data-astro-prefetch
        >
            <span class="text-sm">{currentLang === 'es' ? '游쥟릖' : '游쓇릖'}</span> 
            {currentLang === 'es' ? 'EN' : 'ES'}
        </a>

        <div class='sm:hidden flex flex-1 justify-end items-center'>
          <button id="menu-toggle" class="text-white text-2xl focus:outline-none w-7 h-7">
             <img id="menu-icon" src={menu.src} alt="menu" class="w-full h-full object-contain" />
             <img id="close-icon" src={close.src} alt="close" class="w-full h-full object-contain hidden" />
          </button>
          <div id="mobile-menu" class="hidden p-6 black-gradient absolute top-20 right-0 mx-4 my-2 min-w-[140px] z-10 rounded-xl">
            <ul class='list-none flex justify-end items-start flex-1 flex-col gap-4'>
              {navLinks.map((nav) => (
                <li class="font-poppins font-medium cursor-pointer text-[16px] text-secondary hover:text-white mobile-link">
                  <a href={`#${nav.id}`}>{nav.title}</a>
                </li>
              ))}
            </ul>
          </div>
        </div>
    </div>
  </div>
</nav>

<script>
  // Variable para guardar la funci칩n de limpieza y evitar duplicados
  let cleanupScroll = () => {};

  document.addEventListener('astro:page-load', () => {
    const navbar = document.getElementById('navbar');
    const menuToggle = document.getElementById('menu-toggle');
    const mobileMenu = document.getElementById('mobile-menu');
    const menuIcon = document.getElementById('menu-icon');
    const closeIcon = document.getElementById('close-icon');
    const mobileLinks = document.querySelectorAll('.mobile-link');
    const navItems = document.querySelectorAll('.nav-item');

    // 1. Limpiar listener anterior si existe (importante para ClientRouter)
    cleanupScroll();

    // 2. Efecto Scroll (Cambio de fondo)
    if (navbar) {
      const onScroll = () => {
        if (window.scrollY > 100) {
          navbar.classList.add('bg-[#101428]');
          navbar.classList.remove('bg-transparent');
        } else {
          navbar.classList.add('bg-transparent');
          navbar.classList.remove('bg-[#101428]');
        }
      };
      
      window.addEventListener('scroll', onScroll);
      // Guardamos la funci칩n para removerla cuando cambiemos de p치gina
      cleanupScroll = () => window.removeEventListener('scroll', onScroll);
    }

    // 3. Men칰 M칩vil
    if (menuToggle && mobileMenu && menuIcon && closeIcon) {
      menuToggle.addEventListener('click', () => {
        const isHidden = mobileMenu.classList.contains('hidden');
        if (isHidden) {
            mobileMenu.classList.remove('hidden');
            mobileMenu.classList.add('flex');
            menuIcon.classList.add('hidden');
            closeIcon.classList.remove('hidden');
        } else {
            mobileMenu.classList.add('hidden');
            mobileMenu.classList.remove('flex');
            menuIcon.classList.remove('hidden');
            closeIcon.classList.add('hidden');
        }
      });
    }

    // Cerrar men칰 al hacer click en un link
    mobileLinks.forEach(link => {
      if (mobileMenu && menuToggle && menuIcon && closeIcon) {
        link.addEventListener('click', () => {
          mobileMenu.classList.add('hidden');
          mobileMenu.classList.remove('flex');
          menuIcon.classList.remove('hidden');
          closeIcon.classList.add('hidden');
        });
      }
    });

    // 4. Active Link (Feedback visual simple)
    navItems.forEach(item => {
      item.addEventListener('click', () => {
          navItems.forEach(nav => nav.classList.replace('text-white', 'text-secondary'));
          item.classList.replace('text-secondary', 'text-white');
      });
    });
  });
</script>