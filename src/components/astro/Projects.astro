---
import { styles } from "../../styles";
import ProjectList from "../react/projects/ProjectList.jsx";

interface Props {
  t: Record<string, any>;
  lang: string;
}

const { t = {}, lang } = Astro.props;

// --- OBTENER DATOS ---
const API_URL = import.meta.env.PUBLIC_API_URL || '';
let projects = [];

try {
  const res = await fetch(`${API_URL}/projects`);
  if (res.ok) {
    projects = await res.json();
  } else {
    // Mock Data para que pruebes visualmente si la API falla
    projects = [
      {
        id: 1,
        title: "E-Commerce",
        description_en: "A comprehensive e-commerce platform.",
        tags: [{ name: "React" }, { name: "Node.js" }, { name: "MongoDB" }],
        image_route: "",
        project_url: "#",
        repo_url: "#"
      },
      // ... Agrega más mocks para probar la paginación (al menos 7 items)
    ];
  }
} catch (e) {
  console.error("Error fetching projects:", e);
}
---

<section id="works" class={`${styles.padding} max-w-7xl mx-auto relative z-0`}>
  
  <div class="mb-12">
    <span class={`${styles.sectionSubText}`}>
      {t["projects.subtitle"] || "My work"}
    </span>
    <h2 class={`${styles.sectionHeadText}`}>
      {t["projects.title"] || "Projects."}
    </h2>
    <p class="mt-4 text-secondary text-[17px] max-w-3xl leading-[30px]">
        {t["projects.description"] || "Following projects showcases my skills..."}
    </p>
  </div>

  <div class="w-full flex">
      <ProjectList 
        client:visible 
        projects={projects} 
        t={t} 
        lang={lang} 
      />
  </div>

</section>